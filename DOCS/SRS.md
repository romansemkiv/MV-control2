# SRS — MV Control System

## 1. Вступ

### 1.1 Мета
Створити Web‑систему для керування мультив’юверами та роутингом через протоколи Evertz Quartz та NEXX‑API.

### 1.2 Область застосування
- Підключення до NEXX (REST) для параметрів MV.
- Підключення до Quartz (TCP) для роутингу джерел.

### 1.3 Терміни
- MV: Multiviewer.
- UMD: Over/Under Monitor Display.
- Source: джерело відео.

## 2. Загальний опис

### 2.1 Ролі
- `admin`
- `user`

### 2.2 Користувацькі сценарії (Use Cases)
**Admin:**
- Додає параметри протоколів.
- Перевіряє статус останнього оновлення.
- Створює користувачів, керує доступами.

**User:**
- Бачить стан MV і роутингу.
- Змінює layout, sources, UMD, PCM.

### 2.3 Обмеження
- Протоколи повільні, потрібні rate‑limit і захист від масових оновлень.
- Оновлення стану 1 раз/добу або вручну.
- Один користувач редагує один MV за раз; одночасно у системі може бути кілька користувачів.

## 3. Функціональні вимоги

### 3.1 Автентифікація
- Мінімальна auth система.
- Перший користувач автоматично admin.
- Пароль обов’язковий при першому логіні.
- Відновлення пароля відсутнє, скидання лише адміном.

### 3.2 Управління користувачами
- CRUD користувачів.
- Призначення ролі.
- Призначення доступу до Sources і MV.

### 3.3 Quartz (routing)
- Читання імен входів/виходів: `.RD`, `.RS`.
- Читання поточного роутингу: `.I`.
- Перемикання: `.SV<output,input>`.
- Мапінгу output↔MV window немає.

### 3.4 NEXX‑API (MV параметри)
- Читання і запис параметрів MV.
- Керування layout, borders, font.
- Керування UMD (3 шари).
- Керування PCM Audio bars.
- Enum‑мапінги формуються вручну і можуть змінюватися.

### 3.5 Пресети
- Збереження/виклик/експорт/імпорт.
- Пресети прив’язані до користувача.
- Вікно пресетів:
  - Верх: вибір MV.
  - Низ: чекбокси параметрів.
  - Ті ж опції при збереженні і виклику.

### 3.6 UI
- Темна тема, сучасний вигляд.
- Глобальні параметри MV.
- Вибір MV для редагування.
- Відображення layout з пронумерованими вікнами.
- Панель параметрів обраного вікна.
- Вікно з preview layout, вибір по кліку.

## 4. Нефункціональні вимоги
- Docker‑деплой (Portainer, build у Docker).
- Авто‑оновлення через webhook.
- Стабільність: rate‑limit, throttle.
- Немає audit‑логів.
- Multi‑tenancy не підтримується.

## 5. Дані

### 5.1 Основні сутності
- User, Role.
- Source.
- Multiviewer.
- Window.
- Preset.
- State snapshots.

### 5.2 Мінімальна БД
- Users, UserAccess, Sources, MV, Presets, State.

## 6. Інтеграції
- Quartz TCP, request‑response.
- NEXX REST, EV/GET/SET, API key/JWT.

## 7. Пріоритети (MoSCoW)

### Must
- Auth, ролі, доступи.
- Quartz read routing + switch.
- NEXX read/write базових параметрів MV.
- UI: MV list, layout preview, window settings.
- Пресети (save/load) всередині системи.

### Should
- Імпорт/експорт пресетів.
- Ручний refresh із throttle.
- Статус останнього оновлення.

### Could
- Нічний sync.
- Додаткові валідації та UX‑покращення.

### Won’t
- Live‑оновлення (WebSocket).
- Audit‑лог дій користувачів.
- Multi‑tenancy.
